code_name: 'Tinker 9'
docker:
  image_name: 'mdi/tinker9-cpu'

  build_image:
    - apt-get update
    - apt-get install -y --no-install-recommends gfortran libmpich-dev make git wget vim python3-dev python3-venv python3-pip
    - apt-get install -y --no-install-recommends libfftw3-dev
    - mkdir -p /usr/lib
    - ln -s /usr/lib/x86_64-linux-gnu/libfftw3.a /usr/lib/libfftw3.a
    - ln -s /usr/lib/x86_64-linux-gnu/libfftw3_threads.a /usr/lib/libfftw3_threads.a
    - pip install cmake

  build_engine:
    - |
      if [ ! -d "/repo/build/tinker9" ]; then
        git clone https://github.com/MolSSI-MDI/tinker9.git --branch mdi /repo/build/tinker9
      fi
    - mkdir -p /repo/build/tinker9/build
    - cd /repo/build/tinker9/build
    - FC=gfortran CC=gcc CXX=g++ TINKER_CUDART=1 cmake -DHOST=ON -DPREC=double -DFFTW_DIR=/usr -DMDI=ON ..
    - make VERBOSE=1
    - make test

  validate_engine:
    - echo "Insert code that will confirm that your code has been built successfully"
    - exit 1

engine_tests:
  # Provide at least one example input that can be used to test your code's MDI functionality
  script:
    - echo "Insert commands to run an example calculation here"
    - exit 1



run_scripts:

  water:
    containers:
      container1:
        image: 'mdi/tinker9-cpu'
        script:
          - cd /repo/tests/water
          - /repo/tinker9/build/dynamic9 tinker.xyz /repo/tinker9/params/amoebabio09.prm -k tinker.key 1000 1.0 0.1 4 298.0 1.0 > tinker.out
